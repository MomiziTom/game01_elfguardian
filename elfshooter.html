<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>elfshooter</title>
		<script>
			let canvasW = 1800;
			let canvasH = 600;
			let mouseX = 0;		//マウス位置
			let mouseY = 0;
			let archerX = 0;	//射手位置
			let archerY = 480;
			let alpha = 0.3;
			let aimCircle = 30;
			let clicknow = false;
			let shootnow = false;
			let charge = 0;
			let chargevalue = 0;
			const gravity = 2;
			let fps = setInterval(gameloop,(1/30)*1000);

			class arrow{
				constructor(ctx2d){
					this.angle = 0.0;
					this.aimX = 0;
					this.aimY = 0;
					this.power = 0;
					this.speedX = 1;    //暫定的な値
					this.speedY = -1;
					this.previousX = 0;
					this.previousY = 0;
					this.currentX = 0;
					this.currentY = 0;
					this.shotornot = false;
				}
				shoot(x,y,ox,oy,pow){
					this.angle = Math.atan2((y - oy),(x - ox));
					this.aimX = x;
					this.aimY = y;
					this.power = pow;
					this.speedX = pow * Math.cos(this.angle);    //暫定的な値
					this.speedY = pow * Math.sin(this.angle);
					this.previousX = ox;
					this.previousY = oy;
					this.currentX = ox;
					this.currentY = oy;
					this.shotornot = true;

				}
				move(){
					if(this.shotornot == true){
						this.angle = Math.atan2((this.currentY - this.previousY),(this.currentX - this.previousX));//マイナスラジアンで上向き。右方向水平で0ラジアン。プラスラジアンで下向き。左方向水平でπ(3.1415...)
						this.previousX = this.currentX;
						this.previousY = this.currentY;
						this.currentX +=this.speedX;
						this.speedY += gravity;			//重力を加算　後で消す
						this.currentY +=this.speedY;
					}
				}
			}

			let shot = new arrow();


			function gameloop(){

				//数値計算領域----------------------------------------------------------<
				document.getElementById("field").addEventListener(
					"mousemove",
					function(event){
						mouseX = event.offsetX;
						mouseY = event.offsetY;
					}
				);
				document.getElementById("field").addEventListener(
					"mousedown",
					function(){
						clicknow = true;
					}
				);
				document.getElementById("field").addEventListener(
					"mouseup",
					function(){
						clicknow = false;
						shootnow = true;
					}
				);
				if(clicknow == true){
					++chargevalue;
					charge = chargevalue * chargevalue * 0.3;
					if(charge >= 300){
						charge = 300;
					}

					//照準の不透明度、大きさの変化<
					alpha = charge/400;
					aimCircle = charge/10;
					//照準の不透明度、大きさの変化>
				}
				if(shootnow == true){

					shot.shoot(mouseX,mouseY,archerX,archerY,charge);    //powの値１は暫定的な値
					charge = 0;
					chargevalue = 0;
					alpha = 0.3;
					aimCircle = 30;

					shootnow= false;
				}

				shot.move();
				//数値計算領域---------------------------------------------------------->



				//計算結果画面描画領域----------------------------------------------------------<

				let field = document.getElementById("field");
				field.width = canvasW;
				field.height = canvasH;
				let ctx = field.getContext("2d");


				ctx.clearRect(0,0,canvasW,canvasH);	//描画領域クリア

				if(shot.shotornot == true){
					ctx.strokeStyle = "#000000";
					ctx.globalAlpha = 1;    //照準表示の不透明度
					ctx.lineWidth = 5;
					ctx.lineCap = "round";
					ctx.beginPath();
					ctx.moveTo(shot.previousX,shot.previousY);
					ctx.lineTo(shot.currentX,shot.currentY);
					ctx.stroke();

				}

				//照準表示描画<
				ctx.strokeStyle = "#000000";
				ctx.globalAlpha = alpha;    //照準表示の不透明度
				ctx.lineWidth = aimCircle;  //照準表示の大きさ
				ctx.lineCap = "round";
				ctx.beginPath();
				ctx.moveTo(mouseX,mouseY);
				ctx.lineTo(mouseX,mouseY);
				ctx.stroke();
				//照準表示描画>

				//計算結果画面描画領域---------------------------------------------------------->

				document.getElementById("spantag").textContent = (`${mouseX}  ${mouseY}`);
			}


		</script>
	</head>

	<body>
		<canvas id="field" width="1800" height="480"></canvas>
		<span id="spantag"></span>
		<img src="主人公シャラライメージ.png" style="display: none;">
		<img id="arrowimg" src="arrow.png" style="display: none;">

	</body>
</html>

<!--キャラクター名
	主人公　：　シャララ
	主人公の妹　：　ルーヤ
	--> 